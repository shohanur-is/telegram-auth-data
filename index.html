<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Telegram Auth Data</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
    #status { padding: 10px; margin: 10px 0; border-radius: 4px; background: #f0f8ff; }
    #payload { background: #f5f5f5; padding: 15px; border-radius: 4px; white-space: pre-wrap; }
    button { padding: 8px 16px; background: #0088cc; color: white; border: none; border-radius: 4px; margin-top: 10px; }
    .error { color: #ff0000; }
  </style>
</head>
<body>
  <h2>Telegram Login Data</h2>
  <div id="status">Initializing Telegram widget...</div>
  <div id="widget-container"></div>
  <h3>Auth Data:</h3>
  <pre id="payload">Waiting for authentication...</pre>
  <button id="copy-btn" disabled>Copy Data</button>

  <script>
    // Configuration
    const config = {
      botName: 'ScoringLiveBot',
      botId: '5955048230',
      origin: 'https://shohanur-is.github.io'
    };

    // DOM elements
    const statusEl = document.getElementById('status');
    const payloadEl = document.getElementById('payload');
    const copyBtn = document.getElementById('copy-btn');
    const widgetContainer = document.getElementById('widget-container');

    // Initialize the widget
    function initTelegramWidget() {
      const script = document.createElement('script');
      script.async = true;
      script.src = 'https://telegram.org/js/telegram-widget.js?22';
      script.setAttribute('data-telegram-login', config.botName);
      script.setAttribute('data-size', 'large');
      script.setAttribute('data-userpic', 'false');
      script.setAttribute('data-request-access', 'write');
      script.setAttribute('data-origin', config.origin);
      script.setAttribute('data-onauth', 'onTelegramAuth');
      
      script.onload = () => {
        statusEl.textContent = 'Widget loaded. Click the Telegram button to authenticate.';
      };
      
      script.onerror = () => {
        statusEl.innerHTML = '<span class="error">Failed to load Telegram widget. Please refresh the page.</span>';
      };
      
      widgetContainer.appendChild(script);
    }

    // Auth callback function
    function onTelegramAuth(user) {
      const authData = {
        id: user.id,
        first_name: user.first_name,
        last_name: user.last_name || '',
        username: user.username || '',
        auth_date: user.auth_date,
        hash: user.hash
      };
      
      payloadEl.textContent = JSON.stringify(authData, null, 2);
      statusEl.textContent = 'âœ” Authentication successful!';
      copyBtn.disabled = false;
      
      // Log to console for debugging
      console.log('Telegram auth data:', authData);
    }
    window.onTelegramAuth = onTelegramAuth;

    // Copy button handler
    copyBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(payloadEl.textContent)
        .then(() => {
          const originalText = statusEl.textContent;
          statusEl.textContent = 'Data copied to clipboard!';
          setTimeout(() => statusEl.textContent = originalText, 2000);
        })
        .catch(err => {
          statusEl.innerHTML = '<span class="error">Failed to copy. Please select and copy manually.</span>';
        });
    });

    // Error handling
    window.addEventListener('telegram-widget-load-error', (e) => {
      statusEl.innerHTML = `<span class="error">Widget error: ${e.detail.error}</span>`;
      console.error('Telegram Widget Error:', e.detail.error);
    });

    // Initialize
    initTelegramWidget();

    // Timeout check
    setTimeout(() => {
      if (payloadEl.textContent === 'Waiting for authentication...') {
        statusEl.innerHTML = `
          <span class="error">
            Widget not loaded. Please check:<br>
            1. Bot username (@${config.botName}) is correct<br>
            2. Domain is set in BotFather (/setdomain)<br>
            3. No browser extensions are blocking Telegram
          </span>
        `;
      }
    }, 10000);
  </script>
</body>
</html>
