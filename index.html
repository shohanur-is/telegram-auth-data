<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Telegram Login Widget — Raw JSON Demo</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 24px; }
    h1 { font-size: 20px; margin-bottom: 8px; }
    .widget-wrap { margin: 16px 0; }
    pre#tg-response {
      background: #0b1220;
      color: #d6e6ff;
      padding: 12px;
      border-radius: 8px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .meta { color: #666; font-size: 13px; margin-top: 8px; }
    button.copy { margin-top: 8px; }
  </style>
</head>
<body>
  <h1>Telegram Login Widget — Show Raw Response</h1>
  <p class="meta">Make sure this page is served via <strong>HTTPS</strong> and your bot is linked to your domain in @BotFather (use <code>/setdomain</code>).</p>

  <div class="widget-wrap">
    <!-- Replace ScoringLiveBot with your bot username -->
    <!-- Optionally add data-auth-url="https://your.site/telegram-auth" to enable redirect mode -->
    <script async src="https://telegram.org/js/telegram-widget.js?22"
            data-telegram-login="ScoringLiveBot"
            data-size="large"
            data-onauth="onTelegramAuth"
            data-request-access="write">
    </script>
  </div>

  <h2>Telegram returned object (raw JSON)</h2>
  <pre id="tg-response">Waiting for Telegram login…</pre>
  <div>
    <button class="copy" id="copyBtn">Copy JSON</button>
  </div>

  <script>
    // This function will be called by the widget with the user object:
    // user = { id, first_name, last_name?, username?, photo_url?, auth_date, hash }
    function onTelegramAuth(user) {
      // Pretty-print JSON into the <pre>
      const el = document.getElementById('tg-response');
      el.textContent = JSON.stringify(user, null, 2);

      // Also log to console for debugging
      console.info('Telegram login object:', user);

      // OPTIONAL: Send the received object to your backend for verification.
      // Uncomment and set the correct URL (must be HTTPS).
      /*
      fetch('/telegram-auth-callback', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(user)
      })
      .then(r => r.json())
      .then(js => console.log('Server verified:', js))
      .catch(err => console.error('Error sending to server:', err));
      */

      // Optionally show a small visual cue that data arrived:
      el.style.border = '1px solid #66bb6a';
      el.scrollIntoView({ behavior: 'smooth' });
    }

    // Copy button utility
    document.getElementById('copyBtn').addEventListener('click', () => {
      const txt = document.getElementById('tg-response').textContent;
      if (!txt || txt.includes('Waiting for Telegram')) return alert('No JSON to copy.');
      navigator.clipboard?.writeText(txt).then(
        () => alert('Copied JSON to clipboard'),
        () => alert('Could not copy — select and copy manually')
      );
    });
  </script>
</body>
</html>
